<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerenciamento de Clientes - Re.Conecta</title>
  <style>
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#0b0f14;color:#e6edf3;min-height:100vh;padding:30px}
    .container{max-width:860px;margin:0 auto;background:#121823;border-radius:14px;padding:26px;box-shadow:0 10px 25px rgba(0,0,0,.35)}
    h1{margin:0 0 18px;text-align:center;font-size:32px;color:#22d3ee}
    form{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:14px}
    input{flex:1;min-width:200px;padding:11px 14px;border:1px solid rgba(255,255,255,.10);border-radius:10px;background:rgba(255,255,255,.05);color:#e6edf3}
    button{padding:11px 18px;background:#22d3ee;color:#000;border:none;border-radius:10px;font-weight:700;cursor:pointer;transition:.2s}
    button:hover{background:#8b5cf6;color:#fff}
    .meta{display:flex;gap:10px;align-items:center;margin-bottom:8px;color:#9fb3c8;font-size:13px}
    .pill{border:1px solid rgba(255,255,255,.08);padding:4px 8px;border-radius:999px;background:rgba(255,255,255,.03)}
    .ok{color:#34d399}.err{color:#ef4444}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.10);text-align:left}
    th{color:#22d3ee}
    .msg{margin-top:8px;font-size:14px}
    a{color:#22d3ee;text-decoration:none}
  </style>
</head>
<body>
  <div class="container">
    <div class="meta">
      <span class="pill">Re.Conecta · Clientes</span>
      <span class="pill">Java 17</span>
      <span class="pill"><a href="/swagger-ui/index.html">Swagger</a></span>
      <span id="apiChip" class="pill">API: detectando…</span>
    </div>

    <h1>Gerenciamento de Clientes</h1>

    <form id="clienteForm">
      <input type="text" id="nome" placeholder="Nome" required />
      <input type="email" id="email" placeholder="Email" required />
      <button type="submit">Cadastrar</button>
    </form>

    <div id="mensagem" class="msg"></div>

    <table id="tabelaClientes">
      <thead><tr><th>ID</th><th>Nome</th><th>Email</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    // Candidatos mais comuns de endpoint
    const CANDIDATES = ['/api/clientes', '/api/v1/clientes', '/clientes'];
    let apiUrl = null;

    const apiChip = document.getElementById('apiChip');
    const form = document.getElementById('clienteForm');
    const tabela = document.querySelector('#tabelaClientes tbody');
    const msg = document.getElementById('mensagem');

    function setChipOk(url){ apiChip.textContent = 'API: ' + url; apiChip.classList.remove('err'); apiChip.classList.add('ok'); }
    function setChipErr(text){ apiChip.textContent = 'API: ' + text; apiChip.classList.remove('ok'); apiChip.classList.add('err'); }

    // Tenta descobrir qual endpoint existe (GET lista)
    async function resolveApi() {
      for (const path of CANDIDATES) {
        try {
          const res = await fetch(path, { method: 'GET', headers: { 'Accept': 'application/json' }});
          if (res.ok) { apiUrl = path; setChipOk(path); return; }
        } catch (_) {}
      }
      setChipErr('não encontrado');
    }

    async function carregarClientes() {
      if (!apiUrl) { tabela.innerHTML = '<tr><td colspan="3">API não detectada.</td></tr>'; return; }
      try {
        const res = await fetch(apiUrl, { headers: { 'Accept': 'application/json' }});
        if (!res.ok) {
          const txt = await res.text();
          tabela.innerHTML = `<tr><td colspan="3">Erro ao carregar (status ${res.status}).</td></tr>`;
          msg.innerHTML = `❌ <span class="err">Falha ao listar: status ${res.status}.</span> <small>${txt?.slice(0,200) || ''}</small>`;
          return;
        }
        const data = await res.json();
        tabela.innerHTML = '';
        (Array.isArray(data) ? data : []).forEach(c => {
          const row = `<tr><td>${c.id ?? ''}</td><td>${c.nome ?? ''}</td><td>${c.email ?? ''}</td></tr>`;
          tabela.insertAdjacentHTML('beforeend', row);
        });
        if (!data || data.length === 0) {
          tabela.innerHTML = '<tr><td colspan="3">Nenhum cliente ainda.</td></tr>';
        }
        msg.textContent = '';
      } catch (e) {
        tabela.innerHTML = '<tr><td colspan="3">Erro ao carregar clientes.</td></tr>';
        msg.innerHTML = `❌ <span class="err">Exceção ao listar.</span>`;
      }
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!apiUrl) { msg.innerHTML = '❌ <span class="err">API não detectada.</span>'; return; }

      const payload = {
        nome: document.getElementById('nome').value.trim(),
        email: document.getElementById('email').value.trim()
      };

      try {
        const res = await fetch(apiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
          body: JSON.stringify(payload)
        });
        const text = await res.text();
        if (!res.ok) {
          msg.innerHTML = `❌ <span class="err">Erro ao cadastrar (status ${res.status}).</span> <small>${text?.slice(0,200) || ''}</small>`;
          return;
        }
        msg.innerHTML = '✅ Cliente cadastrado com sucesso!';
        form.reset();
        await carregarClientes();
      } catch (e) {
        msg.innerHTML = '❌ <span class="err">Exceção ao cadastrar.</span>';
      }
    });

    (async () => {
      await resolveApi();
      await carregarClientes();
    })();
  </script>
</body>
</html>
